const CSP_HEADER="content-security-policy";const CSP_HEADER_REPORT_ONLY="content-security-policy-report-only";const CSP_NONCE_HEADER="csp-nonce";function _isPlaceholder(a){return a!=null&& typeof a==='object'&&a['@@functional/placeholder']===true}function _curry1(fn){return function f1(a){if(arguments.length===0||_isPlaceholder(a)){return f1}else{return fn.apply(this,arguments)}}}function _curry2(fn){return function f2(a,b){switch(arguments.length){case 0:return f2;case 1:return _isPlaceholder(a)?f2:_curry1(function(_b){return fn(a,_b)});default:return _isPlaceholder(a)&&_isPlaceholder(b)?f2:_isPlaceholder(a)?_curry1(function(_a){return fn(_a,b)}):_isPlaceholder(b)?_curry1(function(_b){return fn(a,_b)}):fn(a,b)}}}function _arity(n,fn){switch(n){case 0:return function(){return fn.apply(this,arguments)};case 1:return function(a0){return fn.apply(this,arguments)};case 2:return function(a0,a1){return fn.apply(this,arguments)};case 3:return function(a0,a1,a2){return fn.apply(this,arguments)};case 4:return function(a0,a1,a2,a3){return fn.apply(this,arguments)};case 5:return function(a0,a1,a2,a3,a4){return fn.apply(this,arguments)};case 6:return function(a0,a1,a2,a3,a4,a5){return fn.apply(this,arguments)};case 7:return function(a0,a1,a2,a3,a4,a5,a6){return fn.apply(this,arguments)};case 8:return function(a0,a1,a2,a3,a4,a5,a6,a7){return fn.apply(this,arguments)};case 9:return function(a0,a1,a2,a3,a4,a5,a6,a7,a8){return fn.apply(this,arguments)};case 10:return function(a0,a1,a2,a3,a4,a5,a6,a7,a8,a9){return fn.apply(this,arguments)};default:throw new Error('First argument to _arity must be a non-negative integer no greater than ten')}}function _curryN(length,received,fn){return function(){var combined=[];var argsIdx=0;var left=length;var combinedIdx=0;while(combinedIdx<received.length||argsIdx<arguments.length){var result;if(combinedIdx<received.length&&(!_isPlaceholder(received[combinedIdx])||argsIdx>=arguments.length)){result=received[combinedIdx]}else{result=arguments[argsIdx];argsIdx+=1}combined[combinedIdx]=result;if(!_isPlaceholder(result)){left-=1}combinedIdx+=1}return left<=0?fn.apply(this,combined):_arity(left,_curryN(length,combined,fn))}}var curryN=_curry2(function curryN(length,fn){if(length===1){return _curry1(fn)}return _arity(length,_curryN(length,[],fn))});function _curry3(fn){return function f3(a,b,c){switch(arguments.length){case 0:return f3;case 1:return _isPlaceholder(a)?f3:_curry2(function(_b,_c){return fn(a,_b,_c)});case 2:return _isPlaceholder(a)&&_isPlaceholder(b)?f3:_isPlaceholder(a)?_curry2(function(_a,_c){return fn(_a,b,_c)}):_isPlaceholder(b)?_curry2(function(_b,_c){return fn(a,_b,_c)}):_curry1(function(_c){return fn(a,b,_c)});default:return _isPlaceholder(a)&&_isPlaceholder(b)&&_isPlaceholder(c)?f3:_isPlaceholder(a)&&_isPlaceholder(b)?_curry2(function(_a,_b){return fn(_a,_b,c)}):_isPlaceholder(a)&&_isPlaceholder(c)?_curry2(function(_a,_c){return fn(_a,b,_c)}):_isPlaceholder(b)&&_isPlaceholder(c)?_curry2(function(_b,_c){return fn(a,_b,_c)}):_isPlaceholder(a)?_curry1(function(_a){return fn(_a,b,c)}):_isPlaceholder(b)?_curry1(function(_b){return fn(a,_b,c)}):_isPlaceholder(c)?_curry1(function(_c){return fn(a,b,_c)}):fn(a,b,c)}}}var _isArray=Array.isArray||function _isArray(val){return val!=null&&val.length>=0&&Object.prototype.toString.call(val)==='[object Array]'};function _isTransformer(obj){return obj!=null&& typeof obj['@@transducer/step']==='function'}function _dispatchable(methodNames,transducerCreator,fn){return function(){if(arguments.length===0){return fn()}var obj=arguments[arguments.length-1];if(!_isArray(obj)){var idx=0;while(idx<methodNames.length){if(typeof obj[methodNames[idx]]==='function'){return obj[methodNames[idx]].apply(obj,Array.prototype.slice.call(arguments,0,-1))}idx+=1}if(_isTransformer(obj)){var transducer=transducerCreator.apply(null,Array.prototype.slice.call(arguments,0,-1));return transducer(obj)}}return fn.apply(this,arguments)}}var _xfBase={init:function(){return this.xf['@@transducer/init']()},result:function(result){return this.xf['@@transducer/result'](result)}};function _map(fn,functor){var idx=0;var len=functor.length;var result=Array(len);while(idx<len){result[idx]=fn(functor[idx]);idx+=1}return result}function _isString(x){return Object.prototype.toString.call(x)==='[object String]'}var _isArrayLike=_curry1(function isArrayLike(x){if(_isArray(x)){return true}if(!x){return false}if(typeof x!=='object'){return false}if(_isString(x)){return false}if(x.length===0){return true}if(x.length>0){return x.hasOwnProperty(0)&&x.hasOwnProperty(x.length-1)}return false});var XWrap=function(){function XWrap1(fn){this.f=fn}XWrap1.prototype['@@transducer/init']=function(){throw new Error('init not implemented on XWrap')};XWrap1.prototype['@@transducer/result']=function(acc){return acc};XWrap1.prototype['@@transducer/step']=function(acc,x){return this.f(acc,x)};return XWrap1}();function _xwrap(fn){return new XWrap(fn)}var bind=_curry2(function bind(fn,thisObj){return _arity(fn.length,function(){return fn.apply(thisObj,arguments)})});function _arrayReduce(xf,acc,list){var idx=0;var len=list.length;while(idx<len){acc=xf['@@transducer/step'](acc,list[idx]);if(acc&&acc['@@transducer/reduced']){acc=acc['@@transducer/value'];break}idx+=1}return xf['@@transducer/result'](acc)}function _iterableReduce(xf,acc,iter){var step=iter.next();while(!step.done){acc=xf['@@transducer/step'](acc,step.value);if(acc&&acc['@@transducer/reduced']){acc=acc['@@transducer/value'];break}step=iter.next()}return xf['@@transducer/result'](acc)}function _methodReduce(xf,acc,obj,methodName){return xf['@@transducer/result'](obj[methodName](bind(xf['@@transducer/step'],xf),acc))}var symIterator=typeof Symbol!=='undefined'?Symbol.iterator:'@@iterator';function _reduce(fn,acc,list){if(typeof fn==='function'){fn=_xwrap(fn)}if(_isArrayLike(list)){return _arrayReduce(fn,acc,list)}if(typeof list['fantasy-land/reduce']==='function'){return _methodReduce(fn,acc,list,'fantasy-land/reduce')}if(list[symIterator]!=null){return _iterableReduce(fn,acc,list[symIterator]())}if(typeof list.next==='function'){return _iterableReduce(fn,acc,list)}if(typeof list.reduce==='function'){return _methodReduce(fn,acc,list,'reduce')}throw new TypeError('reduce: list must be array or iterable')}var XMap=function(){function XMap1(f,xf){this.xf=xf;this.f=f}XMap1.prototype['@@transducer/init']=_xfBase.init;XMap1.prototype['@@transducer/result']=_xfBase.result;XMap1.prototype['@@transducer/step']=function(result,input){return this.xf['@@transducer/step'](result,this.f(input))};return XMap1}();var _xmap=_curry2(function _xmap(f,xf){return new XMap(f,xf)});function _has(prop,obj){return Object.prototype.hasOwnProperty.call(obj,prop)}var toString=Object.prototype.toString;var _isArguments=function(){return toString.call(arguments)==='[object Arguments]'?function _isArguments(x){return toString.call(x)==='[object Arguments]'}:function _isArguments(x){return _has('callee',x)}}();var hasEnumBug=!({toString:null}).propertyIsEnumerable('toString');var nonEnumerableProps=['constructor','valueOf','isPrototypeOf','toString','propertyIsEnumerable','hasOwnProperty','toLocaleString'];var hasArgsEnumBug=function(){return arguments.propertyIsEnumerable('length')}();var contains=function contains(list,item){var idx=0;while(idx<list.length){if(list[idx]===item){return true}idx+=1}return false};var keys=typeof Object.keys==='function'&&!hasArgsEnumBug?_curry1(function keys(obj){return Object(obj)!==obj?[]:Object.keys(obj)}):_curry1(function keys(obj){if(Object(obj)!==obj){return[]}var prop,nIdx;var ks=[];var checkArgsLength=hasArgsEnumBug&&_isArguments(obj);for(prop in obj){if(_has(prop,obj)&&(!checkArgsLength||prop!=='length')){ks[ks.length]=prop}}if(hasEnumBug){nIdx=nonEnumerableProps.length-1;while(nIdx>=0){prop=nonEnumerableProps[nIdx];if(_has(prop,obj)&&!contains(ks,prop)){ks[ks.length]=prop}nIdx-=1}}return ks});var map=_curry2(_dispatchable(['fantasy-land/map','map'],_xmap,function map(fn,functor){switch(Object.prototype.toString.call(functor)){case'[object Function]':return curryN(functor.length,function(){return fn.call(this,functor.apply(this,arguments))});case'[object Object]':return _reduce(function(acc,key){acc[key]=fn(functor[key]);return acc},{},keys(functor));default:return _map(fn,functor)}}));var map$1=map;var type=_curry1(function type(val){return val===null?'Null':val===undefined?'Undefined':Object.prototype.toString.call(val).slice(8,-1)});function _arrayFromIterator(iter){var list=[];var next;while(!(next=iter.next()).done){list.push(next.value)}return list}function _includesWith(pred,x,list){var idx=0;var len=list.length;while(idx<len){if(pred(x,list[idx])){return true}idx+=1}return false}function _functionName(f){var match=String(f).match(/^function (\w*)/);return match==null?'':match[1]}function _objectIs(a,b){if(a===b){return a!==0||1/a===1/b}else{return a!==a&&b!==b}}var _objectIs$1=typeof Object.is==='function'?Object.is:_objectIs;function _uniqContentEquals(aIterator,bIterator,stackA,stackB){var a=_arrayFromIterator(aIterator);var b1=_arrayFromIterator(bIterator);function eq(_a,_b){return _equals(_a,_b,stackA.slice(),stackB.slice())}return!_includesWith(function(b,aItem){return!_includesWith(eq,aItem,b)},b1,a)}function _equals(a,b,stackA,stackB){if(_objectIs$1(a,b)){return true}var typeA=type(a);if(typeA!==type(b)){return false}if(typeof a['fantasy-land/equals']==='function'|| typeof b['fantasy-land/equals']==='function'){return typeof a['fantasy-land/equals']==='function'&&a['fantasy-land/equals'](b)&& typeof b['fantasy-land/equals']==='function'&&b['fantasy-land/equals'](a)}if(typeof a.equals==='function'|| typeof b.equals==='function'){return typeof a.equals==='function'&&a.equals(b)&& typeof b.equals==='function'&&b.equals(a)}switch(typeA){case'Arguments':case'Array':case'Object':if(typeof a.constructor==='function'&&_functionName(a.constructor)==='Promise'){return a===b}break;case'Boolean':case'Number':case'String':if(!(typeof a===typeof b&&_objectIs$1(a.valueOf(),b.valueOf()))){return false}break;case'Date':if(!_objectIs$1(a.valueOf(),b.valueOf())){return false}break;case'Error':return a.name===b.name&&a.message===b.message;case'RegExp':if(!(a.source===b.source&&a.global===b.global&&a.ignoreCase===b.ignoreCase&&a.multiline===b.multiline&&a.sticky===b.sticky&&a.unicode===b.unicode)){return false}break}var idx=stackA.length-1;while(idx>=0){if(stackA[idx]===a){return stackB[idx]===b}idx-=1}switch(typeA){case'Map':if(a.size!==b.size){return false}return _uniqContentEquals(a.entries(),b.entries(),stackA.concat([a]),stackB.concat([b]));case'Set':if(a.size!==b.size){return false}return _uniqContentEquals(a.values(),b.values(),stackA.concat([a]),stackB.concat([b]));case'Arguments':case'Array':case'Object':case'Boolean':case'Number':case'String':case'Date':case'Error':case'RegExp':case'Int8Array':case'Uint8Array':case'Uint8ClampedArray':case'Int16Array':case'Uint16Array':case'Int32Array':case'Uint32Array':case'Float32Array':case'Float64Array':case'ArrayBuffer':break;default:return false}var keysA=keys(a);if(keysA.length!==keys(b).length){return false}var extendedStackA=stackA.concat([a]);var extendedStackB=stackB.concat([b]);idx=keysA.length-1;while(idx>=0){var key=keysA[idx];if(!(_has(key,b)&&_equals(b[key],a[key],extendedStackA,extendedStackB))){return false}idx-=1}return true}var equals=_curry2(function equals(a,b){return _equals(a,b,[],[])});function _indexOf(list,a,idx){var inf,item;if(typeof list.indexOf==='function'){switch(typeof a){case'number':if(a===0){inf=1/a;while(idx<list.length){item=list[idx];if(item===0&&1/item===inf){return idx}idx+=1}return-1}else if(a!==a){while(idx<list.length){item=list[idx];if(typeof item==='number'&&item!==item){return idx}idx+=1}return-1}return list.indexOf(a,idx);case'string':case'boolean':case'function':case'undefined':return list.indexOf(a,idx);case'object':if(a===null){return list.indexOf(a,idx)}}}while(idx<list.length){if(equals(list[idx],a)){return idx}idx+=1}return-1}function _includes(a,list){return _indexOf(list,a,0)>=0}function _isObject(x){return Object.prototype.toString.call(x)==='[object Object]'}var _Set=function(){function _Set1(){this._nativeSet=typeof Set==='function'?new Set():null;this._items={}}_Set1.prototype.add=function(item){return!hasOrAdd(item,true,this)};_Set1.prototype.has=function(item){return hasOrAdd(item,false,this)};return _Set1}();function hasOrAdd(item,shouldAdd,set){var type1=typeof item;var prevSize,newSize;switch(type1){case'string':case'number':if(item===0&&1/item=== -Infinity){if(set._items['-0']){return true}else{if(shouldAdd){set._items['-0']=true}return false}}if(set._nativeSet!==null){if(shouldAdd){prevSize=set._nativeSet.size;set._nativeSet.add(item);newSize=set._nativeSet.size;return newSize===prevSize}else{return set._nativeSet.has(item)}}else{if(!(type1 in set._items)){if(shouldAdd){set._items[type1]={};set._items[type1][item]=true}return false}else if(item in set._items[type1]){return true}else{if(shouldAdd){set._items[type1][item]=true}return false}}case'boolean':if(type1 in set._items){var bIdx=item?1:0;if(set._items[type1][bIdx]){return true}else{if(shouldAdd){set._items[type1][bIdx]=true}return false}}else{if(shouldAdd){set._items[type1]=item?[false,true]:[true,false]}return false}case'function':if(set._nativeSet!==null){if(shouldAdd){prevSize=set._nativeSet.size;set._nativeSet.add(item);newSize=set._nativeSet.size;return newSize===prevSize}else{return set._nativeSet.has(item)}}else{if(!(type1 in set._items)){if(shouldAdd){set._items[type1]=[item]}return false}if(!_includes(item,set._items[type1])){if(shouldAdd){set._items[type1].push(item)}return false}return true}case'undefined':if(set._items[type1]){return true}else{if(shouldAdd){set._items[type1]=true}return false}case'object':if(item===null){if(!set._items['null']){if(shouldAdd){set._items['null']=true}return false}return true}default:type1=Object.prototype.toString.call(item);if(!(type1 in set._items)){if(shouldAdd){set._items[type1]=[item]}return false}if(!_includes(item,set._items[type1])){if(shouldAdd){set._items[type1].push(item)}return false}return true}}var difference=_curry2(function difference(first,second){var out=[];var idx=0;var firstLen=first.length;var secondLen=second.length;var toFilterOut=new _Set();for(var i=0;i<secondLen;i+=1){toFilterOut.add(second[i])}while(idx<firstLen){if(toFilterOut.add(first[idx])){out[out.length]=first[idx]}idx+=1}return out});var difference$1=difference;var mergeWithKey=_curry3(function mergeWithKey(fn,l,r){var result={};var k;for(k in l){if(_has(k,l)){result[k]=_has(k,r)?fn(k,l[k],r[k]):l[k]}}for(k in r){if(_has(k,r)&&!_has(k,result)){result[k]=r[k]}}return result});var mergeDeepWithKey=_curry3(function mergeDeepWithKey1(fn,lObj,rObj){return mergeWithKey(function(k,lVal,rVal){if(_isObject(lVal)&&_isObject(rVal)){return mergeDeepWithKey1(fn,lVal,rVal)}else{return fn(k,lVal,rVal)}},lObj,rObj)});var mergeDeepWithKey$1=mergeDeepWithKey;const isBoolDirective=directive=>{return["upgrade-insecure-requests","block-all-mixed-content","sandbox",].includes(directive)};const singleQuotify=directiveValue=>`'${directiveValue}'`;const isLiteralDirectiveValue=directiveValue=>{const c1=["script","strict-dynamic","report-sample","self","unsafe-eval","unsafe-hashes","unsafe-inline","none",].includes(directiveValue);const c2=["nonce","sha256","sha384","sha512"].reduce((is,next)=>is||directiveValue.startsWith(`${next}-`),false);return c1||c2};const singleQuotifiedIfLiteral=directiveValue=>isLiteralDirectiveValue(directiveValue)?singleQuotify(directiveValue):directiveValue;const unquotify=directiveValue=>{if(directiveValue.startsWith("'")&&directiveValue.endsWith("'")){return directiveValue.slice(1,-1)}return directiveValue};const arrayifyCspValues=values=>{if(typeof values==="boolean"){return values}let arrayValues;if(typeof values==="string"){arrayValues=values.trim().split(" ").map(v=>v.trim())}else{arrayValues=values||[]}return arrayValues.filter(Boolean)};const arrayifyCspDirectives=directives=>{return map$1(arrayifyCspValues,directives)};const toCspContent=csp=>Object.entries(arrayifyCspDirectives(csp)).map(([attr,values])=>typeof values=="boolean"?isBoolDirective(attr)&&values?attr:"":`${attr} ${values.map(singleQuotifiedIfLiteral).join(" ")}`).filter(Boolean).join(";");const fromCspContent=content=>Object.fromEntries(content.split(";").map(line=>line.trim().split(" ").map(lineItem=>lineItem.trim()).filter(Boolean)).map(line=>{const directive=line[0];const values=line.slice(1);if(isBoolDirective(directive)){return[directive,true]}return directive&&values.length?[directive,values.map(unquotify)]:undefined}).filter(Boolean));const extendCsp=(csp,cspExtension,mergedDirectiveValues="append")=>{const concatValues=(_k,l,r)=>Array.isArray(l)&&Array.isArray(r)&&mergedDirectiveValues==="append"?[...l,...difference$1(r,l)]:Array.isArray(l)&&Array.isArray(r)&&mergedDirectiveValues==="prepend"?[...difference$1(r,l),...l]:r;return mergeDeepWithKey$1(concatValues,arrayifyCspDirectives(csp??{}),arrayifyCspDirectives(cspExtension??{}))};const filterCsp=(directives,excludePatterns)=>{return Object.entries(arrayifyCspDirectives(directives)).reduce((acc,[attr,values])=>{const directive=attr;const excludePattern=excludePatterns[directive];if(excludePattern&& typeof values!=="boolean"){acc[directive]=values.filter(v=>Array.isArray(excludePattern)?!excludePattern.includes(v):!excludePattern.test(v))}else{acc[directive]=values}return acc},{})};const cspDirectiveHas=(directives,directive,patternOrValue)=>{const directiveValues=arrayifyCspDirectives(directives)[directive];if(typeof directiveValues==="boolean"){return directiveValues}if(!directiveValues){return false}return directiveValues.some(v=>typeof patternOrValue==="string"?v.includes(patternOrValue):patternOrValue.test(v))};const empty={directives:{}};class CspBuilder{withDirectives(cspDirectives,mergeDirectiveValues="append"){const extend=typeof cspDirectives==="string"?fromCspContent(cspDirectives):cspDirectives;this._csp.directives=extendCsp(this._csp.directives,extend,mergeDirectiveValues);return this}withoutDirectives(excludeDirectives){for(const directive of excludeDirectives){delete this._csp.directives[directive]}return this}withoutDirectiveValues(excludePatterns){this._csp.directives=filterCsp(this._csp.directives,excludePatterns);return this}withReportOnly(reportOnly=true){this._csp.reportOnly=reportOnly;return this}hasDirective(directive){const directiveValue=this._csp.directives[directive];if(typeof directiveValue==="boolean"){return directiveValue}if(!directiveValue){return false}return directiveValue.length>0}hasDirectiveWithPattern(directive,pattern){cspDirectiveHas(this._csp.directives,directive,pattern)?this:undefined}toHeaderValue(){return toCspContent(this._csp.directives)}toHeaderKeyValue(){const key=this._csp.reportOnly?CSP_HEADER_REPORT_ONLY:CSP_HEADER;return[key,this.toHeaderValue()]}toString(){return this.toHeaderValue()}withScriptNonceApplied(nonce){const nonceWithPrefix=`nonce-${nonce}`;if(this.hasDirective("script-src")){this.withoutDirectiveValues({"script-src":/nonce-/}).withDirectives({"script-src":[nonceWithPrefix]})}return this}withStyleNonceApplied(nonce){const nonceWithPrefix=`nonce-${nonce}`;if(this.hasDirective("style-src")){this.withoutDirectiveValues({"style-src":/nonce-/}).withDirectives({"style-src":[nonceWithPrefix]})}if(this.hasDirective("style-src-elem")){this.withoutDirectiveValues({"style-src-elem":/nonce-/}).withDirectives({"style-src-elem":[nonceWithPrefix]})}return this}csp(){return{...this._csp}}withStrictDynamic(hashesOrNonce,fallback=["https:","unsafe-inline"],extendScriptSrc=false){const hashes=Array.isArray(hashesOrNonce)?hashesOrNonce:[];const nonce=typeof hashesOrNonce==="string"?hashesOrNonce:"";this.withDirectives({"script-src":["strict-dynamic",...fallback,...hashes]},extendScriptSrc?"append":"override");if(nonce){this.withScriptNonceApplied(nonce)}return this}withStyleHashes(elemHashes=[],attrHashes=[],removeUnsafeInline=true){const unsafeHashes=attrHashes.length?["unsafe-hashes"]:[];const unsafeInline=!removeUnsafeInline?['unsafe-inline']:[];if(elemHashes.length||attrHashes.length){this.withDirectives({"style-src":[...elemHashes,...attrHashes,...unsafeHashes,...unsafeInline]})}if(this.hasDirective("style-src-elem")&&elemHashes.length){this.withDirectives({"style-src-elem":[...elemHashes]})}if(this.hasDirective("style-src-attr")&&attrHashes.length){this.withDirectives({"style-src-attr":[...attrHashes,...unsafeHashes]})}if(removeUnsafeInline){this.withoutDirectiveValues({"style-src":["unsafe-inline"],"style-src-elem":["unsafe-inline"],"style-src-attr":["unsafe-inline"]})}return this}withMergedBuilder(b){const{directives,reportOnly}=b.csp();this.withDirectives(directives);this._csp.reportOnly=reportOnly??this._csp.reportOnly}reset(){this._csp={...empty}}isEmpty(){return!Object.keys(this._csp.directives).length}constructor(param){if(param){if(param instanceof CspBuilder){this._csp={...param._csp}}else if(typeof param==="string"){this._csp={directives:fromCspContent(param)}}else if(Array.isArray(param)){const isCspHeader=param[0]===CSP_HEADER;const isCspReportOnlyHeader=param[0]===CSP_HEADER_REPORT_ONLY;if(!(isCspHeader||isCspReportOnlyHeader)){this._csp={...empty}}else{this._csp={directives:fromCspContent(param[1]),reportOnly:!isCspHeader&&isCspReportOnlyHeader}}}else{this._csp={directives:typeof param.directives==="string"?fromCspContent(param.directives):arrayifyCspDirectives(param.directives??{}),reportOnly:param.reportOnly||false}}}else{this._csp={...empty}}}}export{CSP_HEADER,CSP_HEADER_REPORT_ONLY,CSP_NONCE_HEADER,CspBuilder,arrayifyCspDirectives,cspDirectiveHas,extendCsp,filterCsp,fromCspContent,toCspContent}
